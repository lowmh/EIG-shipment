(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1819],{58692:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/carrier/history",function(){return t(36271)}])},36271:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return F}});var l=t(85893),s=t(86886),i=t(15861),n=t(67720),r=t(25358),c=t(67294),d=t(86501),o=t(11163),u=t(42298),h=t(87357),p=t(66242),m=t(38333),x=t(18972),g=t(93946),Z=t(78445),j=t(44267),f=t(58468),v=t(18360),b=t(63730),_=t(50613),y=t(58826),w=t(11057),C=t(90948),S=t(56456),k=t(87536),P=t(9198),W=t.n(P),D=t(6154),E=t(79268);let N=(0,C.ZP)(h.Z)(e=>{let{theme:a}=e;return{display:"flex",alignItems:"center",padding:a.spacing(6),justifyContent:"space-between"}}),M={tracking_number:"",user_id:0,vehicle_id:0,eda_date:null,eta_id:0,image_group_id:0,shipment_status_id:0,remarks:null},z=(0,c.forwardRef)((e,a)=>(0,l.jsx)(S.Z,{sx:{mb:4},fullWidth:!0,...e,inputRef:a,label:"Date Deliver",autoComplete:"off"})),I=e=>{let{open:a,toggle:t,shipmentId:n,condition:r}=e,[o,u]=(0,c.useState)(M),[p,m]=(0,c.useState)([]),[Z,j]=(0,c.useState)([]),[f,v]=(0,c.useState)([]),[_,C]=(0,c.useState)(""),[P,I]=(0,c.useState)([]),{reset:T}=(0,k.cI)({defaultValues:M});(0,c.useEffect)(()=>{u(M),0!==n&&(Y(),H(),O(),R())},[a]),(0,c.useEffect)(()=>{0!==o.image_group_id&&F()},[o.image_group_id]);let Y=async()=>{let e="".concat("http://localhost:5000/").concat("api/shipment","/").concat(n),{data:a}=await D.Z.get(e);u(a)},H=async()=>{let e="".concat("http://localhost:5000/").concat("api/allUser","?limit=50"),{data:a}=await D.Z.get(e);m(a.users)},O=async()=>{let e="".concat("http://localhost:5000/").concat("api/allVehicle"),{data:a}=await D.Z.get(e);j(a)},R=async()=>{let e="".concat("http://localhost:5000/").concat("api/allEta"),{data:a}=await D.Z.get(e);v(a)},F=async()=>{let e="".concat("http://localhost:5000/").concat("api/imageGroup","/").concat(o.image_group_id),{data:a}=await D.Z.get(e);I(a.images),C(a.group_name)},G=(e,a)=>{u(t=>({...t,[e]:a}))},U=e=>{e.preventDefault(),"edit"===r?(A(),V()):"cancel"===r&&X()},V=async()=>{try{let e="".concat("http://localhost:5000/").concat("api/shipment","/").concat(n),a={...o};console.log(e,a),await D.Z.put(e,a),d.ZP.success("Shipment updated successfully!"),q()}catch(t){var e,a;d.ZP.error((null==t?void 0:null===(e=t.response)||void 0===e?void 0:null===(a=e.data)||void 0===a?void 0:a.message)||"Update unsuccessful, please try again!")}},A=async()=>{try{let e="".concat("http://localhost:5000/").concat("api/imageGroup","/").concat(_);await D.Z.put(e,{shipmentStatus:"Shipped",files:P})}catch(t){var e,a;d.ZP.error((null==t?void 0:null===(e=t.response)||void 0===e?void 0:null===(a=e.data)||void 0===a?void 0:a.message)||"Update unsuccessful, please try again!")}},X=async()=>{try{let e="".concat("http://localhost:5000/").concat("api/shipment","/").concat(n);u(a=>{let t={...a,shipment_status_id:3};return D.Z.put(e,t).then(e=>{e.data&&(d.ZP.success("Shipment canceled successfully!"),q())}).catch(e=>{var a,t;d.ZP.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Update unsuccessful, please try again!")}),t})}catch(t){var e,a;d.ZP.error((null==t?void 0:null===(e=t.response)||void 0===e?void 0:null===(a=e.data)||void 0===a?void 0:a.message)||"Update unsuccessful, please try again!")}},q=()=>{t(),T(M),u(M)};return(0,l.jsxs)(y.ZP,{open:a,anchor:"right",variant:"temporary",onClose:q,ModalProps:{keepMounted:!0},sx:{"& .MuiDrawer-paper":{width:{xs:300,sm:400}}},children:[(0,l.jsxs)(N,{children:[(0,l.jsxs)(i.Z,{variant:"h5",children:["view"===r&&"View Shipment","edit"===r&&"Edit Shipment","cancel"===r&&"Cancel Shipment"]}),(0,l.jsx)(g.Z,{size:"small",onClick:q,sx:{p:"0.438rem",borderRadius:1,color:"text.primary",backgroundColor:"action.selected","&:hover":{backgroundColor:e=>"rgba(".concat(e.palette.customColors.main,", 0.16)")}},children:(0,l.jsx)(b.Z,{icon:"tabler:x",fontSize:"1.125rem"})})]}),(0,l.jsx)(h.Z,{sx:{p:e=>e.spacing(0,6,6)},children:(0,l.jsxs)("form",{onSubmit:U,children:["view"===r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.Z,{fullWidth:!0,label:"Tracking Number",value:o.tracking_number,placeholder:"xxxxxx",sx:{mb:4},disabled:!0}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"Driver",value:o.user_id,sx:{mb:4},disabled:!0,children:p.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.first_name," ",e.last_name]},e.id))}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"Vehicle",value:o.vehicle_id,sx:{mb:4},disabled:!0,children:Z.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.car_plate," - ",e.car_model]},e.id))}),(0,l.jsx)(W(),{selected:o.eda_date?new Date(o.eda_date):null,showYearDropdown:!0,showMonthDropdown:!0,id:"form-layouts-tabs-date",placeholderText:"MM-DD-YYYY",customInput:(0,l.jsx)(z,{}),onChange:e=>{},disabled:!0}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"ETA",value:o.eta_id,sx:{mb:4},disabled:!0,children:f.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.name," - ",e.time_range]},e.id))}),(0,l.jsx)(s.ZP,{sx:{mb:4},children:(0,l.jsx)(E.Z,{confirmImages:P,setConfirmImages:I,disabled:!0,drawer:!0})}),(0,l.jsx)(S.Z,{fullWidth:!0,rows:4,multiline:!0,label:"Remarks*",value:o.remarks,placeholder:"",sx:{mb:4},disabled:!0})]}),"edit"===r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.Z,{fullWidth:!0,label:"Tracking Number",value:o.tracking_number,onChange:e=>G("tracking_number",e.target.value),placeholder:"xxxxxx",sx:{mb:4}}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"Select Driver",value:o.user_id,onChange:e=>G("user_id",Number(e.target.value)),sx:{mb:4},children:p.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.first_name," ",e.last_name]},e.id))}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"Select Vehicle",value:o.vehicle_id,onChange:e=>G("vehicle_id",Number(e.target.value)),sx:{mb:4},children:Z.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.car_plate," - ",e.car_model]},e.id))}),(0,l.jsx)(W(),{selected:o.eda_date?new Date(o.eda_date):null,showYearDropdown:!0,showMonthDropdown:!0,id:"form-layouts-tabs-date",placeholderText:"MM-DD-YYYY",customInput:(0,l.jsx)(z,{}),onChange:e=>G("eda_date",e)}),(0,l.jsx)(S.Z,{select:!0,fullWidth:!0,label:"ETA",value:o.eta_id,onChange:e=>G("eta_id",Number(e.target.value)),sx:{mb:4},children:f.map(e=>(0,l.jsxs)(x.Z,{value:e.id,children:[e.name," - ",e.time_range]},e.id))}),(0,l.jsx)(s.ZP,{sx:{mb:4},children:(0,l.jsx)(E.Z,{confirmImages:P,setConfirmImages:I,drawer:!0})})]}),"cancel"===r&&(0,l.jsx)(S.Z,{fullWidth:!0,rows:4,multiline:!0,label:"Remarks*",value:o.remarks,onChange:e=>G("remarks",e.target.value),placeholder:"",sx:{mb:4}}),"view"!==r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w.Z,{type:"submit",variant:"contained",sx:{mr:3},children:"Submit"}),(0,l.jsx)(w.Z,{variant:"tonal",color:"secondary",onClick:q,children:"Cancel"})]})]})})]})},T=e=>{let{value:a,handleFilter:t,toggle:s}=e,i=(0,c.useCallback)(()=>{s()},[s]);return(0,l.jsxs)(h.Z,{sx:{py:4,px:6,rowGap:2,columnGap:4,display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(w.Z,{color:"secondary",variant:"tonal",startIcon:(0,l.jsx)(b.Z,{icon:"tabler:upload"}),children:"Export"}),(0,l.jsxs)(h.Z,{sx:{rowGap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[(0,l.jsx)(S.Z,{value:a,sx:{mr:4},placeholder:"Search Shipment",onChange:e=>t(e.target.value)}),(0,l.jsxs)(w.Z,{onClick:i,variant:"contained",sx:{"& svg":{mr:2}},children:[(0,l.jsx)(b.Z,{fontSize:"1.125rem",icon:"tabler:plus"}),"Add New Shipment"]})]})]})},Y={Shipped:"warning",Completed:"success",Cancelled:"error"},H=()=>{let e=(0,o.useRouter)(),a=e=>{let{id:a,status:t}=e,[s,i]=(0,c.useState)(null),n=e=>{i(e.currentTarget)},r=()=>{i(null)},d=()=>{R("view"),H(a),A(),r()},o=()=>{R("edit"),H(a),A(),r()},u=()=>{R("cancel"),H(a),A(),r()};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{size:"small",onClick:n,children:(0,l.jsx)(b.Z,{icon:"tabler:dots-vertical"})}),(0,l.jsxs)(m.Z,{keepMounted:!0,anchorEl:s,open:!!s,onClose:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{style:{minWidth:"8rem"}},children:[(0,l.jsxs)(x.Z,{onClick:d,sx:{"& svg":{mr:2}},children:[(0,l.jsx)(b.Z,{icon:"tabler:eye",fontSize:20}),"View"]}),"Completed"!==t&&(0,l.jsxs)(x.Z,{onClick:o,sx:{"& svg":{mr:2}},children:[(0,l.jsx)(b.Z,{icon:"tabler:edit",fontSize:20}),"Edit"]}),"Cancelled"!==t&&(0,l.jsxs)(x.Z,{onClick:u,sx:{"& svg":{mr:2}},children:[(0,l.jsx)(b.Z,{icon:"tabler:trash",fontSize:20}),"Cancel"]})]})]})},[t,r]=(0,c.useState)(""),[y,w]=(0,c.useState)(""),[C,S]=(0,c.useState)({page:0,pageSize:10}),[k,P]=(0,c.useState)([]),[W,E]=(0,c.useState)([]),[N,M]=(0,c.useState)(!1),[z,H]=(0,c.useState)(0),[O,R]=(0,c.useState)(""),F=async e=>{try{var a;let t=await D.Z.get("".concat("http://localhost:5000/").concat("api/allShipment"),{params:e});P((null===(a=t.data)||void 0===a?void 0:a.data)||[]),S({page:(t.data.page||1)-1,pageSize:t.data.limit||10})}catch(e){d.ZP.error("Error fetching shipment data")}},G=async()=>{try{let e=await D.Z.get("".concat("http://localhost:5000/").concat("api/allShipmentStatus"));E(e.data||[])}catch(e){d.ZP.error("Error fetching shipment statuses")}},U=(0,c.useCallback)(e=>r(e),[]),V=(0,c.useCallback)(e=>{w(e.target.value)},[]);(0,c.useEffect)(()=>{F({status:y,search:t,page:C.page+1,limit:C.pageSize})},[y,t,N]),(0,c.useEffect)(()=>{G()},[]);let A=()=>M(!N);return(0,l.jsxs)(s.ZP,{container:!0,spacing:6.5,children:[(0,l.jsx)(s.ZP,{item:!0,xs:12,children:(0,l.jsxs)(p.Z,{children:[(0,l.jsx)(Z.Z,{title:"Search Filters"}),(0,l.jsx)(j.Z,{children:(0,l.jsx)(s.ZP,{container:!0,spacing:6,children:(0,l.jsx)(s.ZP,{item:!0,sm:4,xs:12,children:(0,l.jsxs)(v.Z,{fullWidth:!0,value:y,onChange:V,displayEmpty:!0,children:[(0,l.jsx)(x.Z,{value:"",children:"Select Status"}),W.map(e=>(0,l.jsx)(x.Z,{value:e.id,children:e.name},e.id))]})})})}),(0,l.jsx)(n.Z,{sx:{m:"0 !important"}}),(0,l.jsx)(T,{value:t,handleFilter:U,toggle:()=>e.push("/carrier/shipment")}),(0,l.jsx)(f._,{autoHeight:!0,rowHeight:62,rows:k,columns:[{flex:.2,minWidth:200,field:"b2b_order_id",headerName:"Order Number",renderCell:e=>{let{row:a}=e,{b2b_order_id:t,tracking_number:s}=a;return(0,l.jsx)(h.Z,{sx:{display:"flex",alignItems:"center"},children:(0,l.jsxs)(h.Z,{sx:{display:"flex",flexDirection:"column"},children:[(0,l.jsx)(i.Z,{noWrap:!0,sx:{fontWeight:500,color:"text.secondary"},children:t}),(0,l.jsxs)(i.Z,{noWrap:!0,variant:"body2",sx:{color:"text.disabled"},children:["Tracking Number: ",s]})]})})}},{flex:.15,field:"status",minWidth:100,headerName:"Status",renderCell:e=>{let{row:a}=e,{shipment_status:t}=a;return(0,l.jsx)(_.Z,{rounded:!0,skin:"light",size:"small",label:t,color:Y[t],sx:{textTransform:"capitalize"}})}},{flex:.15,minWidth:100,field:"created_date",headerName:"Date Created",renderCell:e=>{let{row:a}=e,{created_date:t}=a,s=t?(0,u.default)(new Date(t),"yyyy-MM-dd HH:mm"):"";return(0,l.jsx)(h.Z,{sx:{display:"flex",alignItems:"center"},children:(0,l.jsx)(i.Z,{noWrap:!0,sx:{color:"text.secondary"},children:s})})}},{flex:.15,minWidth:100,field:"updated_date",headerName:"Date Completed",renderCell:e=>{let{row:a}=e,{created_date:t,updated_date:s,shipment_status:n}=a,r=s?(0,u.default)(new Date(s),"yyyy-MM-dd HH:mm"):"";return(0,l.jsx)(h.Z,{sx:{display:"flex",alignItems:"center"},children:(0,l.jsx)(i.Z,{noWrap:!0,sx:{color:"text.secondary"},children:"Completed"===n&&s!==t?r:"-"})})}},{flex:.1,minWidth:80,sortable:!1,field:"actions",headerName:"Actions",renderCell:e=>{let{row:t}=e;return(0,l.jsx)(a,{id:t.id,status:t.shipment_status})}}],disableRowSelectionOnClick:!0,pageSizeOptions:[1,5,10,25,50],paginationModel:C,onPaginationModelChange:S})]})}),(0,l.jsx)(I,{open:N,toggle:A,shipmentId:z,condition:O})]})};var O=t(82229);let R=()=>(0,l.jsx)(O.Z,{children:(0,l.jsxs)(s.ZP,{container:!0,spacing:6,children:[(0,l.jsx)(r.Z,{title:(0,l.jsx)(i.Z,{variant:"h2",children:"Shipment History"})}),(0,l.jsx)(s.ZP,{item:!0,xs:12,mt:3,mb:3,children:(0,l.jsx)(n.Z,{})}),(0,l.jsx)(s.ZP,{item:!0,xs:12,children:(0,l.jsx)(H,{})})]})});R.acl={action:"read",subject:"history-page"};var F=R},459:function(){}},function(e){e.O(0,[9198,3863,7693,8468,7536,3873,2229,1782,9774,2888,179],function(){return e(e.s=58692)}),_N_E=e.O()}]);